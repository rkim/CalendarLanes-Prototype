<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script type="text/javascript" src="./scripts/jquery-1.10.0.min.js"></script>
		<script type="text/javascript" src="./scripts/jquery.kinetic.js"></script>
		<script type="text/javascript" src="./scripts/infinite.scheduler.js"></script>

		<script type="text/javascript" src="./scripts/fd.scheduler.js"></script>

		<link href="./styles/lanes.css" media="screen" rel="stylesheet" type="text/css">
		<link href="./styles/event.occurrence.css" media="screen" rel="stylesheet" type="text/css">

	<script type="text/javascript">
		function xscroll() {
			var isSafari = Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0;
			var isChrome = !!window.chrome;  

			$('#xscroll').prop('checked') ?
				$('.calendar-scroller').css({"overflow-x":"auto"}) :
				$('.calendar-scroller').css({"overflow-x":"hidden"});

			if (isChrome || isSafari){
				$('.scheduler').css({"border-bottom":"0px"});
			}
		};

		
		$(document).ready(function() {
			// -----------------------------
			// Initialize demo controls
			$('#xscroll').click(function() {xscroll();});
			xscroll();
			
			// -----------------------------
			// Attach circular scrolling
			//$('.calendar-scroller').infiniteScrollable();

			// -----------------------------
			// Front Desk Scheduler!
			$('#basic').fdScheduler();

			// -----------------------------
			// Attach kinetic scrolling
			$('.calendar-scroller').kinetic({
				cursor:'ew-resize',
				y:false,
				maxvelocity: 55,
				triggerHardware:true
			});

			// -----------------------------
			// Event handlers for Front Desk
			// Scheduler
			//
			// All this will eventually get
			// packaged up into a jQuery plugin.
			var expandedEvents = new Array();
			var collapseEvents = function() {
				if (expandedEvents.length > 0) {	
					while(expandedEvents.length > 0) {
						var event = expandedEvents.pop();
						var $this = $(event);

						$this.prop("expanded", false);
						$this.css({"opacity":"1", "pointer-events":"auto"});
						$this.children('.event_o').children().css({"display":"block"});
					}
				}
			}

			// NOTE :: rkim :: 02-Jun-2013
			// There's a built-in delay to .click that won't work in
			// touch-enabled devices.  Use.bind('touchstart', ...)
			// instead.
			
			var dragged = false;
			var mousedown = false;
			var clientX = 0;
			var clientY = 0;

			$(".scheduler").click(function(e) {
				collapseEvents();
			});

			$(".scheduler").mousedown(function(e) {
				mousedown = true;
				clientX = e.clientX;
				clientY = e.clientY;
				// bind mousemove

			});
			$(".scheduler").mousemove(function(e) {
				if (mousedown) {
					collapseEvents();
				}
			});
			$(".scheduler").mouseup(function(e) {
				mousedown = false;
			});

			$('.scheduler .event').click(function(e){

				$this = $(this);
				var isExpanded = $this.prop("expanded");
				if (!isExpanded) 
				{
					$this.prop("expanded", true);
					$this.css({"opacity":"0.3", "pointer-events":"none"});
					$this.children('.event_o').children().css({"display":"none"});

					expandedEvents.push($this);
					e.stopPropagation();
					// bind scheduler.click?
				}
			});

		});	// $(document).ready(...)
		
	</script>
	</head>
	
	
	<body style="width:100%;">
	<div id="content">
		<div style="height:40px"></div>

		<!-- 
		- base layout
		-->
		<div style="width:400px;">
			<p class="title">base layout</p>
		</div>

		<div class="viewport">
			<div style="height:100px"></div>
			<div class="divider"></div>
			<!-- scheduler -->
			<div id="basic" class="scheduler"></div>
		</div><!-- viewport -->

		<div style="height:40px;"></div>
		<div style="width:400px;">
			<p class="title">notes</p>
			<p class="strong">Completed:
				<ul>
					<li>Scrolling momentum and deceleration.</li>
					<li>Triggers and handlers on day boundaries.</li>
					<li>Event-Occurrence overlays.</li>
					<li>Sane CSS heirarchy.</li>
					<li>Firefox support (Holy crap this sucked).</li>
					<li>Determine event stacking method: "Pyramid" vs. "Fallen
						Dominoes."</li>
					<li>Rework the calendar grid so that the grid lines fall <b>under</b>
						the hour text instead of bookending them. Maybe add half-hour
						demarcations as well.</li>
					<li>Propogate touch scroll events captured in the scrollable
						scheduler properly out to the rest of the DOM.</li>
					<li>Fix flickering of schedule on tap inputs on iPad and
						other touch-enabled devices.</li>
					<li>Restructured layout to better accomodate dynamic rendering
						via javascript.</li>
					<li>Consistent treatment of borders in scheduler DOM elements
						across all browsers.</li>
				</ul>
			</p>
			<p class="strong">Not yet implemented:
				<ul>
					<li>Package dynamic scheduler functionality into a jQuery plugin.</li>
					<li>Detect touch-enabled devices and bind click, mousedown, mousemove and
						mouseup handlers to custom handlers for touchstart, touchmove, and
						touchend.</li>
					<li>Hover-over/tap handler to explode overlapping events.</li>
					<li>Current-time marker</li>
					<li>Render event counts per lane.</li>
					<li>Dispatch to event edit page.</li>
					<li>Make the "scroll-bounce" region on touch devices...prettier.</li>
					<li>Bit of a stretch, but try to capture and prevent two-finger 
						swipe navigation in webkit browsers when the event occurs
						within the calendar.</li>

				</ul>
			</p>
			<p class="strong">Cut features:
				<ul>
					<li>Continuous scrolling functionality.</li>
					<li>Drag-reordering of lanes. This gets weird when groups are
						visible.</li>
					<lI>Tap/click to close and expand lanes.</li>
					<li>Smart z-index handling - instead of using crazy z-index values
						to manage everything, manipulate and reorder elements in the DOM.</li>
				</ul>
			</p>
			<p style="padding-left:15px">
				Two-finger scrolling won't work unless scrollbars are enabled
				(scrollbars are styled to be hidden in gecko and webkit browsers,
				but will show in IE).
			</p>
			<div style="padding-left:15px;">
				<input id="xscroll" type="checkbox" name="xscroll" checked='true'>enable scrollbars</input>
			</div>
		</div>
		<div style="height:40px;"></div>

		<!-- 
		- event occurrence
		-->
		<div style="width:400px;">
			<p class="title">event occurrence</p>
			<p>An single event occurrence without a home (calendar) to live in.</p>

			<div class="event" style="left:50px; height:90.0px; width:150px;">
				<div class="event_o service_color_1 type_class">
					<span class="name_and_time">
					<span class="full_time">
					<span class="start_at">1pm</span>
					<span class="dash">-</span>
					<span class="end_at">2:30pm</span>
					</span>
					<span class="name"><strong>Class A</strong> w/ Staff 1</span>
					<span class="location">- Seattle</span>
					</span>
				</div>
			</div><!-- event -->
			<div style="height:90px"></div>
			<p>It took some work to get these to be well-behaved like this. Its
				untamed brethren in the current schedule view tend to splay across
				the entire page and does funny stuff on hover when not constrained by
				a <strong>#schedule-week-grid -> .grid -> .days -> .day</strong>
				layout.</p>
			<p>The hover-over handler is off for now, by the way. I'm working on a 
				new one better suited for the complexities presented with overlapping
				event-occurrences.</p>
		</div>

		<div style="height:80px;"></div>
	</div>
	</body>
</html>